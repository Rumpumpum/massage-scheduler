<!DOCTYPE html>
<html>
<head>
  <title>–ú–∞—Å—Å–∞–∂</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; }
    input { margin: 5px; padding: 5px; }
    button { padding: 5px 10px; }
    #appointments div { border: 1px solid #ccc; margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <div>
    <input id="clientName" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
    <input id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
    <input id="serviceDescription" placeholder="–£—Å–ª—É–≥–∞">
    <input id="cost" type="number" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±)">
    <input id="time" type="time" step="600">
    <button onclick="addNewAppointment()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <div id="appointments"></div>
  <button onclick="showDailyEarnings()">–ò—Ç–æ–≥–∏ –¥–Ω—è</button>

  <script>
    Telegram.WebApp.ready();
    let appointments = JSON.parse(localStorage.getItem("appointments")) || [];

    const today = new Date().toISOString().split("T")[0];
    document.getElementById("time").setAttribute("min", today + "T00:00");
    document.getElementById("time").setAttribute("max", today + "T23:59");

    function addNewAppointment() {
      const clientName = document.getElementById("clientName").value;
      const clientPhone = document.getElementById("clientPhone").value;
      const serviceDescription = document.getElementById("serviceDescription").value;
      const cost = parseInt(document.getElementById("cost").value);
      const timeInput = document.getElementById("time").value;

      if (!clientName || !clientPhone || !serviceDescription || !cost || !timeInput) {
        Telegram.WebApp.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
        return;
      }

      const time = `${today} ${timeInput}`;
      const appointment = {
        id: Date.now(),
        clientName,
        clientPhone,
        serviceDescription,
        cost,
        time,
        completed: false,
        paid: false
      };
      appointments.push(appointment);
      localStorage.setItem("appointments", JSON.stringify(appointments));
      updateAppointmentsList();
      clearForm();
    }

    function clearForm() {
      document.getElementById("clientName").value = "";
      document.getElementById("clientPhone").value = "";
      document.getElementById("serviceDescription").value = "";
      document.getElementById("cost").value = "";
      document.getElementById("time").value = "";
    }

    function updateAppointmentsList() {
      const list = document.getElementById("appointments");
      list.innerHTML = appointments.map(app => 
        `<div>
          ${app.clientName} - ${app.serviceDescription} - ${app.cost} —Ä—É–± - ${app.time.split(" ")[1]}
          <button onclick="markCompleted(${app.id})">${app.completed ? "‚úÖ" : "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"}</button>
          <button onclick="markPaid(${app.id})">${app.paid ? "üí∞" : "–û–ø–ª–∞—á–µ–Ω–æ"}</button>
        </div>`
      ).join("");
    }

    function markCompleted(id) {
      const app = appointments.find(a => a.id === id);
      app.completed = !app.completed;
      localStorage.setItem("appointments", JSON.stringify(appointments));
      updateAppointmentsList();
    }

    function markPaid(id) {
      const app = appointments.find(a => a.id === id);
      app.paid = !app.paid;
      localStorage.setItem("appointments", JSON.stringify(appointments));
      updateAppointmentsList();
    }

    function showDailyEarnings() {
      const today = new Date().toISOString().split("T")[0];
      const earnings = appointments
        .filter(app => app.time.startsWith(today) && app.completed && app.paid)
        .reduce((sum, app) => sum + app.cost, 0);
      Telegram.WebApp.showAlert(`–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –∑–∞ –¥–µ–Ω—å: ${earnings} —Ä—É–±.`);
    }

    updateAppointmentsList();
  </script>
</body>
</html>
